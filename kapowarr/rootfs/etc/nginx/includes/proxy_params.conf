# ==============================================================================
# proxy_params.conf — Common nginx proxy header configuration
#
# Included by servers/ingress.conf via:
#   include /etc/nginx/includes/proxy_params.conf;
#
# These headers pass client information through the proxy to the backend
# application so it can correctly determine the originating IP, protocol,
# and hostname.
# ==============================================================================

# Pass the original Host header (required by many apps for URL construction)
proxy_set_header Host               $http_host;

# Pass the true client IP address
proxy_set_header X-Real-IP          $remote_addr;

# Build the forwarded-for chain
proxy_set_header X-Forwarded-For    $proxy_add_x_forwarded_for;

# Pass the original protocol (http/https)
proxy_set_header X-Forwarded-Proto  $scheme;

# Forward the HA ingress path prefix to the backend.
#
# HA ingress adds an X-Ingress-Path header to every request, containing the
# full path prefix under which the add-on is mounted (e.g. /api/hassio_ingress/<token>).
# Forwarding it lets the backend application construct absolute URLs correctly
# without needing to read the APP_BASE_URL environment variable.
#
# Apps that embed absolute paths (href="/static/app.js") typically need either:
#   a) this header (preferred — no nginx rewriting needed), or
#   b) the sub_filter rewriting directives in ingress.conf (fallback).
proxy_set_header X-Ingress-Path     $http_x_ingress_path;
